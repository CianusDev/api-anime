"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const NekoSama = require("./NekoSama");
(async () => {
    const animes = await NekoSama.search("beast tamer");
    console.log(animes.map(anime => animes.indexOf(anime) + ". " + anime.preferedName).join("\n"));
    console.log("Enter the index of the anime you want to download: ");
    // Read stdin for user input
    const index = await new Promise(resolve => {
        process.stdin.once("data", data => {
            resolve(parseInt(data.toString()));
        });
    });
    const anime = animes[index];
    await anime.fetchAllInformations();
    try {
        fs_1.mkdirSync("./" + anime.preferedName);
    }
    catch (e) { }
    for (let episode of anime.episodes) {
        console.log("Downloading episode " + episode.episodeCount + "...");
        if (animes[index].episodes.indexOf(episode) < 0)
            continue;
        await episode.fetchStreamData();
        await NekoSama.download(episode.stream, 1080, "./" + anime.preferedName + "/" + episode.episodeCount + ".mp4", (data) => {
            console.log(episode.episodeCount + " / " + anime.episodes.length + " | " + data.current + " / " + data.duration + " | " + data.speed + "x");
        });
    }
})();
